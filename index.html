<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>江浙沪舞厅跳舞计时器</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; height: 100vh; display: flex; flex-direction: column; }
    .container { flex: 1; display: flex; flex-direction: column; max-width: 100%; background: white; }
    .header { background: black; color: white; text-align: center; padding: 18px; font-size: 24px; position: relative; flex-shrink: 0; }
    .fullscreen-btn { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px; border-radius: 50%; font-size: 24px; cursor: pointer; }
    .section { padding: 20px; flex-shrink: 0; }
    .mode-switch { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .mode-btn { padding: 14px 35px; border-radius: 30px; background: #eee; position: relative; font-size: 19px; min-width: 120px; text-align: center; }
    .mode-btn.active { background: #a5dee5; }
    .mode-btn input { opacity: 0; position: absolute; width: 100%; height: 100%; cursor: pointer; left: 0; top: 0; }
    .mode-btn .check { position: absolute; left: 18px; top: 12px; color: #00bfa5; font-weight: bold; font-size: 20px; display: none; }
    .mode-btn.active .check { display: block; }
    .input-group { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 19px; }
    .input-group input { width: 180px; padding: 16px; border: 1px solid #ddd; border-radius: 12px; text-align: center; font-size: 22px; }
    .info { flex: 1; padding: 10px 20px; display: flex; flex-direction: column; justify-content: center; font-size: 19px; }
    .info > div { display: flex; justify-content: space-between; margin-bottom: 18px; }
    .info span:first-child { color: #333; }
    .highlight { color: #00bfa5 !important; font-weight: bold; font-size: 42px !important; text-align: right; }
    .status { text-align: center; padding: 20px; font-size: 22px; color: #00bfa5; font-weight: bold; flex-shrink: 0; }
    .buttons { display: flex; justify-content: space-around; padding: 25px 20px; background: #f9f9f9; flex-shrink: 0; }
    .btn { padding: 20px 45px; border-radius: 40px; border: none; font-size: 22px; cursor: pointer; min-width: 120px; }
    .btn-start { background: #00bfa5; color: white; }
    .btn-end, .btn-reset { background: #eee; color: #666; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/nosleep.js@0.12.0/dist/NoSleep.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      江浙沪舞厅跳舞计时器
      <button class="fullscreen-btn" id="fullscreen-btn">⛶</button>
    </div>

    <div class="section">
      <div class="mode-switch">
        <div class="mode-btn active">
          <input type="radio" name="mode" id="qu" checked>
          <span class="check">✓</span> 按曲
        </div>
        <div class="mode-btn">
          <input type="radio" name="mode" id="min">
          <span class="check">✓</span> 按分钟
        </div>
      </div>

      <div id="qu-fields">
        <div class="input-group"><span>每曲价格：</span><div><input type="number" id="price-qu" value="20"> 元/曲</div></div>
        <div class="input-group"><span>每曲时长：</span><div><input type="number" id="time-qu" value="4"> 分钟</div></div>
      </div>

      <div id="min-fields" style="display:none;">
        <div class="input-group"><span>每分钟价格：</span><div><input type="number" id="price-min" value="5"> 元/分钟</div></div>
        <div class="input-group"><span>最少跳：</span><div><input type="number" id="min-time" value="4"> 分钟</div></div>
      </div>
    </div>

    <div class="info">
      <div><span>当前时间：</span><span id="current-time"></span></div>
      <div><span>开始时间：</span><span id="start-time">--</span></div>
      <div><span>结束时间：</span><span id="end-time">--</span></div>
      <div><span>总共时间：</span><span id="total-time" class="highlight">--</span></div>
      <div id="total-qu-line"><span>总共曲数：</span><span id="total-qu" class="highlight">--</span></div>
      <div><span>总共花费：</span><span id="total-cost" class="highlight">--</span></div>
    </div>

    <div class="status">计费状态：<span id="status-text">未计费</span></div>

    <div class="buttons">
      <button class="btn btn-start" id="btn-start">开始</button>
      <button class="btn btn-end" id="btn-end">结束</button>
      <button class="btn btn-reset" id="btn-reset">复位</button>
    </div>
  </div>

  <script>
    const noSleep = new NoSleep();
    let startTime = null;
    let timer = null;
    let isRunning = false;

    document.getElementById('fullscreen-btn').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        noSleep.enable();
      } else {
        document.exitFullscreen();
        noSleep.disable();
      }
    });

    // 当前时间
    function updateCurrentTime() {
      const now = new Date();
      const date = now.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '/');
      const time = now.toTimeString().slice(0, 8);
      document.getElementById('current-time').textContent = `${date} ${time}`;
    }
    setInterval(updateCurrentTime, 100);
    updateCurrentTime();

    // 模式切换
    document.getElementById('qu').addEventListener('change', () => {
      document.getElementById('qu-fields').style.display = 'block';
      document.getElementById('min-fields').style.display = 'none';
      document.getElementById('total-qu-line').style.display = 'flex';
      resetCalc();
    });
    document.getElementById('min').addEventListener('change', () => {
      document.getElementById('qu-fields').style.display = 'none';
      document.getElementById('min-fields').style.display = 'block';
      document.getElementById('total-qu-line').style.display = 'none';
      resetCalc();
    });

    // 开始
    document.getElementById('btn-start').addEventListener('click', () => {
      if (isRunning) return;
      isRunning = true;
      startTime = new Date();
      document.getElementById('start-time').textContent = startTime.toTimeString().slice(0, 8);
      document.getElementById('status-text').textContent = '计费中';
      noSleep.enable();
      timer = setInterval(updateTimer, 50);
      updateTimer();
    });

    // 结束
    document.getElementById('btn-end').addEventListener('click', () => {
      if (!isRunning) return;
      clearInterval(timer);
      isRunning = false;
      const end = new Date();
      document.getElementById('end-time').textContent = end.toTimeString().slice(0, 8);
      calculateTotal();
      noSleep.disable();
    });

    // 复位
    document.getElementById('btn-reset').addEventListener('click', () => {
      clearInterval(timer);
      isRunning = false;
      startTime = null;
      resetCalc();
      document.getElementById('status-text').textContent = '未计费';
      document.getElementById('start-time').textContent = '--';
      document.getElementById('end-time').textContent = '--';
      noSleep.disable();
    });

    function updateTimer() {
      if (!startTime) return;
      calculateTotal();
    }

    function calculateTotal() {
      const now = new Date();
      const diffMs = now - startTime;
      const totalSeconds = Math.floor(diffMs / 1000);
      const ms = diffMs % 1000;
      const seconds = totalSeconds % 60;
      const minutes = Math.floor(totalSeconds / 60) % 60;
      const hours = Math.floor(totalSeconds / 3600);
      const timeStr = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}.${String(ms).padStart(3,'0')}`;
      document.getElementById('total-time').textContent = timeStr;

      let cost = 0;
      let qu = '--';

      if (document.getElementById('qu').checked) {
        const pricePerQu = parseFloat(document.getElementById('price-qu').value) || 0;
        const timePerQuMin = parseFloat(document.getElementById('time-qu').value) || 1;
        const timePerQuMs = timePerQuMin * 60 * 1000;
        qu = Math.ceil(diffMs / timePerQuMs);
        cost = qu * pricePerQu;
        document.getElementById('total-qu').textContent = qu + ' 曲';
      } else {
        const pricePerMin = parseFloat(document.getElementById('price-min').value) || 0;
        const minTime = parseFloat(document.getElementById('min-time').value) || 0;
        const effectiveMin = Math.max(Math.ceil(diffMs / 60000), minTime);
        cost = effectiveMin * pricePerMin;
      }
      document.getElementById('total-cost').textContent = '¥' + cost.toFixed(0);
    }

    function resetCalc() {
      document.getElementById('total-time').textContent = '--';
      document.getElementById('total-qu').textContent = '--';
      document.getElementById('total-cost').textContent = '--';
    }
  </script>
</body>
</html>
